<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dino Runner</title>
<style>
html, body {margin:0; padding:0; height:100%; display:flex; justify-content:center; align-items:center; background:#f3f4f6; font-family:Arial;}
#wrap {position:relative; width:1100px;}
canvas {width:100%; height:auto; background:#fff; border-radius:8px; box-shadow:0 12px 36px rgba(0,0,0,0.08); border:1px solid #ccc;}
.overlay {position:absolute; inset:0; display:flex; justify-content:center; align-items:center; pointer-events:none;}
.panel {pointer-events:auto; background:rgba(255,255,255,0.98); padding:18px; border-radius:10px; width:420px; text-align:center; box-shadow:0 12px 34px rgba(0,0,0,0.08);}
button {cursor:pointer; padding:10px 16px; border-radius:8px; border:1px solid #d0d6df; background:#fff; font-size:15px;}
#loadingBar {height:10px; background:#eef3fb; border-radius:6px; overflow:hidden; margin:12px auto; width:320px;}
#loadingFill {height:100%; width:0%; background:#2b8be6; transition:width .12s linear;}
#errors, #debug {font-size:13px; margin-top:8px; text-align:left; max-height:120px; overflow:auto;}
@media(max-width:480px){.panel{width:92%;}}
</style>
</head>
<body>
<div id="wrap">
<canvas id="gameCanvas" width="1100" height="600"></canvas>
<div class="overlay" id="overlay">
  <div class="panel" id="menu">
    <h2 id="title">Dino Runner</h2>
    <div id="hint">Loading assets — please wait</div>
    <div id="loadingBar"><div id="loadingFill"></div></div>
    <div id="loadingText" style="font-size:13px;margin-top:6px">0 / 0</div>
    <div style="height:8px"></div>
    <div style="display:flex; gap:10px; justify-content:center">
      <button id="startBtn" disabled>Start</button>
      <button id="pauseBtn" disabled>Pause</button>
    </div>
    <div id="errors"></div>
    <div id="debug"></div>
  </div>
</div>
</div>

<script>
/* ===========================
   ASSETS CONFIG
=========================== */
const ASSETS = {
  RUNNING: ["assets/Dino/DinoRun1.png","assets/Dino/DinoRun2.png"],
  JUMPING: "assets/Dino/DinoJump.png",
  DUCKING: ["assets/Dino/DinoDuck1.png","assets/Dino/DinoDuck2.png"],
  SMALL_CACTUS: ["assets/Cactus/SmallCactus1.png","assets/Cactus/SmallCactus2.png","assets/Cactus/SmallCactus3.png"],
  BIRD: ["assets/Bird/Bird1.png","assets/Bird/Bird2.png"],
  CLOUD: "assets/Others/Cloud.png",
  BG: "assets/Others/Track.png"
};

const SIZE = {
  RUNNING: {w:88,h:94},
  JUMPING: {w:88,h:94},
  DUCKING: {w:118,h:60},
  SMALL_CACTUS: [{w:40,h:71},{w:99,h:95},{w:105,h:71}],
  BIRD: {w:92,h:80},
  CLOUD: {w:90,h:30},
  BG: {w:1100,h:20}
};

/* ===========================
   DOM & CANVAS
=========================== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const loadingFill = document.getElementById('loadingFill');
const loadingText = document.getElementById('loadingText');
const errorsDom = document.getElementById('errors');
const hintDom = document.getElementById('hint');

/* ===========================
   STATE
=========================== */
let assetsLoaded = {};
let loadErrors = [];
let gameRunning = false, paused = false;
let player, cloud;
let obstacles = [];
let keys = {};
let gameSpeed = 12;
let points = 0;
let lastTime = 0;
let lastSpawn = 0;
let spawnInterval = 1200;

/* ===========================
   PRELOAD IMAGES
=========================== */
function preload(list, onProgress){
  return new Promise(resolve=>{
    const flat=[];
    Object.keys(list).forEach(k=>{
      const v=list[k];
      if(Array.isArray(v)) v.forEach(p=>flat.push({k,path:p}));
      else flat.push({k,path:v});
    });
    const total = flat.length;
    if(total===0) return resolve({ok:true});
    let done=0;
    flat.forEach(entry=>{
      const img = new Image();
      img.src = entry.path;
      img.onload = ()=> {
        if(Array.isArray(list[entry.k])){
          assetsLoaded[entry.k] = assetsLoaded[entry.k] || [];
          assetsLoaded[entry.k].push(img);
        } else {
          assetsLoaded[entry.k] = img;
        }
        done++;
        onProgress(done,total,entry.path,true);
        if(done + loadErrors.length === total) resolve({ok:loadErrors.length===0, errors:loadErrors});
      };
      img.onerror = ()=>{
        loadErrors.push(entry.path);
        done++;
        onProgress(done,total,entry.path,false);
        if(done + loadErrors.length === total) resolve({ok:false, errors:loadErrors});
      };
    });
  });
}

/* ===========================
   UTILS
=========================== */
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function rectsCollide(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }

/* ===========================
   CLASSES
=========================== */
class Dino {
  constructor(){ this.x=80; this.groundY=310; this.duckY=340; this.y=this.groundY; this.state='run'; this.step=0; this.jumpVel=0; this.jumpPower=12; this.gravity=0.8; this.w=SIZE.RUNNING.w; this.h=SIZE.RUNNING.h; }
  update(){
    if(this.state!=='jump'){
      if(keys['ArrowDown']) this.state='duck';
      else if(keys[' ']||keys['ArrowUp']||keys['Spacebar']){ this.state='jump'; this.jumpVel=-this.jumpPower; }
      else this.state='run';
    }
    if(this.state==='jump'){
      this.jumpVel += this.gravity; this.y += this.jumpVel;
      if(this.y>=this.groundY){ this.y=this.groundY; this.state='run'; this.jumpVel=0; }
      this.w = SIZE.JUMPING.w; this.h = SIZE.JUMPING.h;
    } else if(this.state==='duck'){ this.y=this.duckY; this.w=SIZE.DUCKING.w; this.h=SIZE.DUCKING.h; }
    else { this.y=this.groundY; this.w=SIZE.RUNNING.w; this.h=SIZE.RUNNING.h; }
    this.step=(this.step+1)%20;
  }
  draw(){
    if(this.state==='jump'){ if(assetsLoaded.JUMPING) ctx.drawImage(assetsLoaded.JUMPING,this.x,this.y,this.w,this.h);}
    else if(this.state==='duck'){ const f=Math.floor(this.step/10); const img=assetsLoaded.DUCKING[f]||assetsLoaded.RUNNING[0]; ctx.drawImage(img,this.x,this.y,this.w,this.h);}
    else { const f=Math.floor(this.step/10); const img=assetsLoaded.RUNNING[f]; if(img) ctx.drawImage(img,this.x,this.y,this.w,this.h);}
  }
  rect(){ return {x:this.x,y:this.y,w:this.w,h:this.h}; }
}

class Cloud {
  constructor(){ this.reset(); }
  reset(){ this.x=W+rand(300,1100); this.y=rand(40,120); this.w=SIZE.CLOUD.w; this.h=SIZE.CLOUD.h; }
  update(){ this.x-=gameSpeed*0.4; if(this.x<-this.w) this.reset(); }
  draw(){ if(assetsLoaded.CLOUD) ctx.drawImage(assetsLoaded.CLOUD,this.x,this.y,this.w,this.h);}
}

class Obstacle {
  constructor(){ 
    this.type=rand(0,ASSETS.SMALL_CACTUS.length-1);
    this.img=assetsLoaded.SMALL_CACTUS[this.type];
    this.w=SIZE.SMALL_CACTUS[this.type].w;
    this.h=SIZE.SMALL_CACTUS[this.type].h;
    this.x=W+10; this.y=H-this.h-75;
  }
  update(){ this.x-=gameSpeed; }
  draw(){ if(this.img) ctx.drawImage(this.img,this.x,this.y,this.w,this.h);}
  rect(){ return {x:this.x,y:this.y,w:this.w,h:this.h}; }
}

class Bird extends Obstacle {
  constructor(){ super(); this.img=assetsLoaded.BIRD[0]; this.y=250; this.frame=0; }
  update(){ super.update(); this.frame=(this.frame+1)%10; this.img=assetsLoaded.BIRD[Math.floor(this.frame/5)]; }
}

/* ===========================
   GAME FUNCTIONS
=========================== */
function spawnObstacle(){
  const choice=rand(0,1);
  if(choice===0) obstacles.push(new Obstacle());
  else obstacles.push(new Bird());
}

function resetGame(){
  player=new Dino();
  cloud=new Cloud();
  obstacles=[];
  gameSpeed=12;
  points=0;
  lastSpawn=0;
}

/* ===========================
   MAIN LOOP
=========================== */
function loop(timestamp){
  if(!gameRunning) return;
  ctx.clearRect(0,0,W,H);

  // background
  if(assetsLoaded.BG) ctx.drawImage(assetsLoaded.BG,0,H-75,SIZE.BG.w,SIZE.BG.h);
  
  // cloud
  cloud.update(); cloud.draw();

  // spawn obstacles
  if(timestamp-lastSpawn>spawnInterval){ spawnObstacle(); lastSpawn=timestamp; }

  // update & draw obstacles
  for(let i=obstacles.length-1;i>=0;i--){
    obstacles[i].update(); obstacles[i].draw();
    if(rectsCollide(player.rect(),obstacles[i].rect())){
      gameRunning=false;
      overlay.style.display='flex';
      hintDom.innerText='Game Over — Press Start to Retry';
      startBtn.disabled=false;
      return;
    }
    if(obstacles[i].x+obstacles[i].w<0) obstacles.splice(i,1);
  }

  // player
  player.update(); player.draw();

  // score
  points++; ctx.fillStyle='black'; ctx.font='20px Arial'; ctx.fillText('Score: '+points,1000,40);

  requestAnimationFrame(loop);
}

/* ===========================
   EVENTS
=========================== */
document.addEventListener('keydown', e=>{ keys[e.key]=true; });
document.addEventListener('keyup', e=>{ keys[e.key]=false; });

startBtn.addEventListener('click',()=>{
  overlay.style.display='none';
  resetGame();
  gameRunning=true;
  requestAnimationFrame(loop);
});

pauseBtn.addEventListener('click',()=>{
  paused=!paused;
  gameRunning=!paused;
});

/* ===========================
   PRELOAD ALL IMAGES
=========================== */
preload(ASSETS,(done,total,path,ok)=>{
  loadingFill.style.width = Math.floor(done/total*100)+'%';
  loadingText.innerText = done+' / '+total;
}).then(res=>{
  if(loadErrors.length>0){
    errorsDom.innerText='Missing files:\n'+loadErrors.join('\n');
  }
  startBtn.disabled=false;
  hintDom.innerText='Press Start to Play';
});
</script>
</body>
</html>




